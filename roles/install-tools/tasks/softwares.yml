---
- name: Installing softwares from repo
  package:
    name:
      - jq
      - ghidra
      - ntpdate
      - exiftool
      - docker.io
      - flameshot
      - burpsuite
      - apt-transport-https
    state: present
  become: true
  become_method: sudo

- name: Installing GDB
  apt:
    name: gdb
    state: present
  become: true
  become_method: sudo
  register: gdb_output
  ignore_errors: true
  no_log: true

- name: GDB installation failed due to dependency issue, Downloading script for manual install
  ansible.builtin.get_url:
    url: "https://github.com/DGclasher/normie-scripts/raw/main/gdb-installer/gdb-installer.sh"
    dest: /tmp/
    mode: '0744'
    timeout: 30
  when: gdb_output.failed == true

- name: Message
  debug:
    msg: "Go to /tmp and execute the gdb-installer.sh script"
  when: gdb_output.failed == true

- name: Downloading some other stuffs
  ansible.builtin.get_url:
    url: "{{ item.url }}"
    dest: "/usr/local/bin/{{ item.name }}"
    mode: '0711'
    timeout: 30
  loop:
    - { url: "https://github.com/docker/compose/releases/latest/download/docker-compose-linux-x86_64", name: "docker-compose" }
    - { url: "https://dl.k8s.io/release/{{ lookup('url','https://dl.k8s.io/release/stable.txt') }}/bin/linux/amd64/kubectl", name: "kubectl" }
  become: true
  become_method: sudo
  async: 80
  poll: 0
